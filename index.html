<head>
</head>
<body>
  <form>
    <label>Choose References file</label>
    <input type="file" id="references" multiple="true"></input>
    <hr/>
    <label>Output</label>
    <textarea id="output" rows="100" style="width:100%"></textarea>
  </form>

  <script>
    var heading = document.querySelector('#heading');
    var output = document.querySelector('#output');

    document.querySelector('#references').addEventListener('change', function(e) {
      Array.prototype.forEach.call(e.target.files, function(file) {
        var reader = new FileReader();
        reader.readAsText(file);

        reader.onload = function(e) {
          var html = e.target.result;

          // remove leading junk
          html = html.replace(/^[\S\s]*<body>/m, '');

          // remove trailing junk
          html = html.replace(/<\/body[\S\s]*$/m, '');

          // substitute each <p> with </li><li>
          html = html.replace(/<p>/g, '</li>\n<li>');

          // remove final '<li>'
          html = html.trim().replace(/<li>$/, '');

          // add surrouding <ol>
          html = '<ol>\n\n<li>' + html + '\n</ol>';


          // add top link
          html += '<p><a href="#Top">Top</a></p>';

          // add heading
          var name = file.name.split('.')[0];
          var anchor = name.replace(/\s/g, '_');
          html = '<h2>' + name
            + '<a id="' + anchor + '" title="NewBookmark" data-ektron-placeholder="bookmark"></a>'
            + '</h2>\n' + html;

          output.value += html + '\n\n';
        };
      });
    });
  </script>
</body>
